<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cse.google.com; script-src 'self' 'unsafe-inline' https://cse.google.com; style-src 'self' 'unsafe-inline' https://cse.google.com;">
    <title>BistiAnonymous Анонимна Търсачка</title>
    <style>
        /* ... Вашият съществуващ CSS код ... */
        #clear-data, #open-incognito {
            margin-top: 10px;
            background: none;
            border: 1px solid #7d82f0;
            color: #7d82f0;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1><a href="/" class="logo">BistiAnonymous</a></h1>
    
    <div id="search-container">
        <input type="text" id="search-box" placeholder="Търсете анонимно...">
        <button id="clear-search">✕</button>
    </div>
    
    <button id="clear-data">Изчисти всички данни</button>
    <button id="open-incognito">Отвори в инкогнито режим</button>

    <div id="results-container">
        <div class="gcse-searchresults-only"></div>
    </div>

    <div id="privacy-disclaimer">
        <p>Поверителност: Тази търсачка се стреми към максимална анонимност. Не съхраняваме история на търсенията или лични данни. Въпреки това, използваме Google Custom Search Engine, което може да събира ограничени данни. За повече информация, моля, прочетете нашата <a href="/privacy-policy.html" target="_blank" rel="noopener noreferrer">политика за поверителност</a>.</p>
    </div>

    <script async src="https://cse.google.com/cse.js?cx=60c020d44283f4851"></script>
    <script>
        function clearLocalData() {
            localStorage.clear();
            sessionStorage.clear();
            var cookies = document.cookie.split(";");
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i];
                var eqPos = cookie.indexOf("=");
                var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
            }
            console.log("Локалните данни и бисквитките бяха изчистени.");
        }

        function clearUrlParameters() {
            if (window.history && window.history.replaceState) {
                var cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                window.history.replaceState({}, document.title, cleanUrl);
            }
        }

        function openIncognito() {
            var incognitoUrl = 'https://duckduckgo.com/?q=' + encodeURIComponent(document.getElementById('search-box').value);
            window.open(incognitoUrl, '_blank');
        }

        window.onload = function() {
            var searchBox = document.getElementById('search-box');
            var clearButton = document.getElementById('clear-search');
            var clearDataButton = document.getElementById('clear-data');
            var openIncognitoButton = document.getElementById('open-incognito');

            searchBox.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Предотвратяваме стандартното поведение
                    openIncognito(); // Отваряме търсенето в нов прозорец с DuckDuckGo
                    setTimeout(function() {
                        clearLocalData();
                        clearUrlParameters();
                        searchBox.value = '';
                    }, 100);
                }
            });

            searchBox.addEventListener('input', function() {
                clearButton.style.display = this.value ? 'block' : 'none';
            });

            clearButton.addEventListener('click', function() {
                searchBox.value = '';
                clearButton.style.display = 'none';
                searchBox.focus();
            });

            clearDataButton.addEventListener('click', function() {
                clearLocalData();
                clearUrlParameters();
                location.reload();
            });

            openIncognitoButton.addEventListener('click', openIncognito);

            if (navigator.doNotTrack === "1") {
                console.log("Do Not Track е активирано. Допълнително ограничаване на проследяването.");
            }

            // Предотвратяваме запазването на историята
            if (window.history && window.history.pushState) {
                window.history.pushState(null, null, window.location.href);
                window.onpopstate = function () {
                    window.history.go(1);
                };
            }

            // ... Вашият съществуващ код за стилизиране на резултатите от търсенето ...
        };
    </script>
</body>
</html>
